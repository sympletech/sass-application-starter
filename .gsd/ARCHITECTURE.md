# Architecture

> Auto-generated by /map on 2026-01-20

## Overview

This is a full-stack SaaS starter application designed for subscription-based services. It handles user authentication (email/password and social OAuth), subscription management with Stripe (including free trials), and account status (active/inactive).

```
┌─────────────────────────────────────────┐
│          [Frontend: React 19]           │
├─────────────────────────────────────────┤
│        [API: Express 5 Routes]          │
├─────────────────────────────────────────┤
│ [Services: Stripe, Passport, MongoDB]   │
└─────────────────────────────────────────┘
```

## Components

### Backend Server (`@server/server.js`)
- **Purpose:** Entry point for the Express application.
- **Responsibilities:** Configures middleware (CORS, session, static files), initializes MongoDB connection, registers OAuth and API routes.

### Dynamic Route Loader (`@server/lib/register-routes.js`)
- **Purpose:** Automatically registers routes based on file patterns.
- **Responsibilities:** Scans `@server/routes/**/_*-routes.js`, wraps handlers with error handling and JSON responses.

### Auth & Billing Routes (`@server/routes/auth/_auth-routes.js`)
- **Purpose:** Core business logic for users and payments.
- **Responsibilities:** Signup with Stripe trial, Login with bcrypt, Account cancellation/reactivation, Stripe portal integration.

### Frontend Layouts (`@client/src/layouts/`)
- **Purpose:** Shared UI structure.
- **Locations:** `public/PublicLayout.jsx` (unauthenticated), `logged-in/LoggedInLayout.jsx` (authenticated).

### Auth Components (`@client/src/components/auth/`)
- **Purpose:** Reusable authentication UI elements.
- **Components:** `AuthCard`, `PaymentForm`, `SocialAuthButtons`.

## Data Flow

1. **User Action:** User interacts with the React frontend (e.g., signs up).
2. **API Request:** Frontend sends a request to the Express backend using `axios` or `SWR`.
3. **Route Handling:** The dynamic route loader passes the request to the corresponding handler.
4. **Service Integration:** The handler interacts with Stripe (to create customers/subscriptions) and MongoDB (to store user data).
5. **Session Management:** Upon successful login/signup, a session is created and stored in MongoDB via `express-session`.
6. **Response:** The backend returns a JSON response, which the frontend uses to update the UI or redirect the user.

## Integration Points

| Service | Type | Purpose |
|---------|------|---------|
| Stripe | API | Payment processing and subscription management |
| MongoDB | DB | Data persistence for accounts and sessions |
| Google/FB/Twitter | OAuth | Social authentication providers |

## Technical Debt

- **Dynamic Imports:** The use of `import.meta.dirname` and dynamic imports in `register-routes.js` might need careful handling in different environments.
- **Naming Inconsistencies:** The file `@server/lib/regrister-oauth.js` has a typo in its name ("regrister").
- **Error Handling:** Route handlers throw generic errors which are caught by the wrapper, but more specific error types could improve granularity.

## Conventions

- **Naming:** Backend routes use `_*-routes.js` pattern for discovery. Frontend components use PascalCase.
- **Structure:** Mono-repo style with `@client` and `@server` directories.
- **Testing:** No formal testing framework seen in `package.json` dependencies (only ESLint for linting).
